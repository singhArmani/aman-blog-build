{"data":{"site":{"siteMetadata":{"title":"Aman's Blog","author":"Amandeep Singh"}},"markdownRemark":{"id":"6b55e4c4-bc45-58cc-87c5-8fdffc81885e","excerpt":"Closures  can be a daunting concept when you are new to JavaScript world. Scouring the internet will give you tons of definition about what  closure  is. But I…","html":"<p><strong>Closures</strong> can be a daunting concept when you are new to JavaScript world. Scouring the internet will give you tons of definition about what <em>closure</em> is. But I have felt that mostly these definitions are vague and don’t explain the fundamental cause of their existence.</p>\n<p>Today we will try to demystify some of these concepts which are part of the <a href=\"https://tc39.github.io/ecma262\">ECMAScript 262 specs</a>, including <strong>Execution</strong> <strong>Context</strong>, <strong>Lexical Environment</strong>, and <strong>Identifier Resolution</strong>. Additionally, we will learn that because of these mechanisms, all <em>functions</em> in ECMAScript are <em>closures</em>.</p>\n<p>I will explain the terminology first and then show you some code examples explaining how all these pieces work together. This will help to solidify your understanding.</p>\n<h2>Execution Context</h2>\n<p>JavaScript interpreter creates a new context whenever it’s about to execute a function or script we’ve written. Every script/code starts with an execution context called a global execution context. And every time we call a function, a new execution context is created and is put on top of the execution stack. The same pattern follows when you call the nested function which calls another nested function:</p>\n<p>\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/525613a3ed5283c001b211cc4d42ffc3/f9431/execution_context.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 60.092449922958394%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAAsSAAALEgHS3X78AAACmUlEQVQoz22TWW/iaBBF+f+/YzSa0UhRq5N0SDOBpiGAWWxoFgcTIIB3di9sjn3mwzy1NCVdXfulXKduOaM5Q8pqkfq4Qk0rI72/UtVKVIYlqsMK/tEnukQcT2eizyTVJYq5fMap+37A+XLmWkmSkGnrMvfFF+5/5nkoFchWSzxVSty9PPC1/IWZM+d0jOjPPOrqkpa2TtUcLlHGe+x1gDQtcPb3hO6SzC+zw5sVojmfjNxIeCQ8oWfoSGLqsTHF2wd0JxtqfYtaz6ShOkji+drYXofUP0pEvodnWmRasyaSVme4GjKwBwycAaqrpu895xf6yhAsVxxuWPxeYXik8VERDX180yajzFv8285TfZd4FTurjmr8HJQp9ksUugXm7oJY7CpOYv6vDocjzVmV5BDeJuwYbV4rX8g//8FL7k+K+b+RyneUf/xDrv7IQkwYR58Epspu0mA3bbGfymwnLYKZTLBxKWtFjPEY37KvDRUuSwXvLU+v8BfvlTtwZaEWnckrI13scLtjKS5Bb35Fbz1gKo+pr7pPeIKgNq1w2m5vyK2PBjWBNrY7aKK5ZsgMhUamgjJvsljqN+RTANHxpstB+E0HcTZX5DgIbsjXlAdLFXX1Rt8d0LV6dO0ePRFQW3zAWJkkcYLl2Sz2BoZnYfo2+t7EDCw23g55XiMKRCi2Q0YWU2Sr3/hez6aHPFypIu1eqvpUYrQYs997/OjkeZTuyTa+8dx8Iic/89QQ6K4uUq5y2azZvo/J9I0eWSlLrpmjJJLt6G1ksWxlriCNJKyVw1n8JTNnxsSeMnU+Ur9pwsIycbYuSXThFIRkTucT22AvtGPtbVhuV6x2a1zh692GWODGcUwQiH2Fp1RhcCTwD6l8P/ztjP4DJHBoVAGhuvgAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"alt text\"\n        title=\"execution context\"\n        src=\"/static/525613a3ed5283c001b211cc4d42ffc3/623ee/execution_context.png\"\n        srcset=\"/static/525613a3ed5283c001b211cc4d42ffc3/816c5/execution_context.png 148w,\n/static/525613a3ed5283c001b211cc4d42ffc3/c766b/execution_context.png 295w,\n/static/525613a3ed5283c001b211cc4d42ffc3/623ee/execution_context.png 590w,\n/static/525613a3ed5283c001b211cc4d42ffc3/f9431/execution_context.png 649w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<p>Let’s see what happens when our code is executed as shown in the picture above:</p>\n<ul>\n<li>A global execution context is created and placed at the bottom of the execution stack.</li>\n<li>When the bar is invoked, a new bar execution context is created and is put on top of the global execution context.</li>\n<li>As, bar calls to a nested function foo, a new foo execution context is created and is placed on top of the bar execution context.</li>\n<li>When foo returns, its context is popped out of the stack and flow returns to the bar context.</li>\n<li>Once bar execution is finished, the flow returns back to the global context and finally, the stack is emptied.</li>\n</ul>\n<p>Execution stack works on a LIFO data structure way. It waits for the topmost execution context to return before executing the context below.</p>\n<p>Conceptually, Execution context has a structure which looks like the following:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">  <span class=\"token comment\">// Execution context in ES5</span>\nExecutionContext <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  ThisBinding<span class=\"token punctuation\">:</span> <span class=\"token operator\">&lt;</span><span class=\"token keyword\">this</span> value<span class=\"token operator\">></span><span class=\"token punctuation\">,</span>\n  VariableEnvironment<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span> <span class=\"token operator\">...</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  LexicalEnvironment<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span> <span class=\"token operator\">...</span> <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<br/>\n<p>Don’t worry if structure looks intimidating. We will look at these components shortly. The key point to remember is that every call to execution context has two stages: <strong>Creation Stage</strong> and <strong>Execution Stage</strong>. Creation Stage is when the context is created but not invoked yet.</p>\n<p>A few things happen in the <em>creation</em> stage:</p>\n<ul>\n<li><strong>VariableEnvironment</strong> component is used for the initial storage for the variables, arguments and function declarations. The var declared variables are initialized with the value of undefined.</li>\n<li>The value of <em>This</em> is determine.</li>\n<li><strong>LexicalEnvironment</strong> is just the copy of VariableEnvironment at this stage.</li>\n</ul>\n<p>Upon <em>execution</em> stage:</p>\n<ul>\n<li>Values are assigned.</li>\n<li>LexicalEnvironment is used to resolve the bindings.</li>\n</ul>\n<p>Now, let’s try to understand what is a lexical environment.</p>\n<h2>Lexical Environment</h2>\n<p>According to ECMAScript specification 262 (8.1):</p>\n<blockquote>\n<p>A Lexical Environment is a specification type used to define the association of <a href=\"https://tc39.github.io/ecma262/#prod-Identifier\">Identifiers</a> to specific variables and functions based upon the lexical nesting structure of ECMAScript code.</p>\n</blockquote>\n<p>Let’s try to simplify a few things here. A lexical environment consists of two main components: the <strong>environment</strong> record and a <strong>reference</strong> to the outer (parent) lexical environment:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">var</span> x <span class=\"token operator\">=</span> <span class=\"token number\">10</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">foo</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">var</span> y <span class=\"token operator\">=</span> <span class=\"token number\">20</span><span class=\"token punctuation\">;</span>\n console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>x<span class=\"token operator\">+</span>y<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 30</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// Environment technically consist of two main components:</span>\n<span class=\"token comment\">// environmentRecord, and a reference to the outer environment</span>\n\n<span class=\"token comment\">// Environment of the global context</span>\nglobalEnvironment <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  environmentRecord<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// built-ins</span>\n    <span class=\"token comment\">// our bindings:</span>\n    <span class=\"token comment\">// highligh-next-line</span>\n    x<span class=\"token punctuation\">:</span> <span class=\"token number\">10</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  outer<span class=\"token punctuation\">:</span> <span class=\"token keyword\">null</span> <span class=\"token comment\">// no parent environment</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// Environment of the \"foo\" function</span>\nfooEnvironment <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  environmentRecord<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n    y<span class=\"token punctuation\">:</span> <span class=\"token number\">20</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"gatsby-highlight-code-line\">  outer<span class=\"token punctuation\">:</span> globalEnvironment</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<br/>\n<p>Visually it will look like this:</p>\n<p>\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/86bcebd393ecf6190bb2debdcaa38d09/46886/lexical_environment.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 452px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 73.67256637168141%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAAAsSAAALEgHS3X78AAADAUlEQVQ4y4WT22/iVhCH/f+/VpX2qVIrVSttVVXpJs2W3IEYbGPMzVwMjrnYQDaEqw0kgL8OTqR9qmJpNHPm/OacOfI3Sty9Aj/HzrvDU78QGH/xaP0NQR4GKq/eLdHymXgj1ruDYY6ReYKb/YKT/kz14lemtXM5I8trP4cyF9F6XCAcFXiofKNlnuE3rln6OtHQYCaicDWD/Yr5MR7qjJ0b0Z0m2oZxytC5IxqJdmCgWIMCXzMn/JM7peIXKQ+K1EYVGt9t1GaWe7FgPOJh4FIKihQ8ncrQEk0Zq1+gPWtyaaYwPI36qIaS7+SkUCXfyqG7Ohk7g9bWKPaK4vPJ3tN0wjJcUPcbVLt24ms9m7JXoR40sTolan0bZ9iRDn2TCyMlHZ5Rlc70jkbZL8mBZrIuDUpMl/Jk+fb7A/Eh5pDY4c1Ljpj3XIxSkicWXANduqr4lXdf5sa6oeiZlPo/DoyPlR98ymazYbPdshVbSxyt18l68jwlDKMk3u/3bwfGhw9N+b+bpvMVu8OP9ce9vXe4m3XYzz0O8y7xopvEhD4Tz2Lz1JZ1l93Lhni3Fo3H6/SB7bOb+M2kw4v4o+a4t1v0UWLvEsY6q0aK9B8/YV/+hnPzO2FL8iMtAf4ItlQKvBnGxa9k//w5Ado6/4X8yScm5bME+NeegO32srQ6GZoCZ9NVqYtvuRm68vfbnkqzneV5+sR88Yg3yIsVcHs6nW6e9oMqfBqiVyWv0wvKKKYgcpb/xrlxgdm3KIhZQRX7qUmuo3Pv5Akex3hBFzMoYQ4sSsMKBaFD8wyaM4dbO52sa+MGin4Eu5ElU0tT7BbIijeExWNOF7CPSC1WSzb7SCakiNrKyLRoHCdM66jcN9Jk63fknAz2sCocBgK2jM6/+rncUJVpyUuhcFi+FtE9ZXnGbDknellRlYLb0q1cpibMao7GlXlFSktxbV1T822Ulu/QHrq0Ry5NiWueTaPfSsaoFTjU+01WUZhAfQR8tQ5ZREuJ58lF4SYi2q7f8uGS/wCF6j7b4wnrnQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"alt text\"\n        title=\"LexicalEnvironment\"\n        src=\"/static/86bcebd393ecf6190bb2debdcaa38d09/46886/lexical_environment.png\"\n        srcset=\"/static/86bcebd393ecf6190bb2debdcaa38d09/3f5f2/lexical_environment.png 148w,\n/static/86bcebd393ecf6190bb2debdcaa38d09/74913/lexical_environment.png 295w,\n/static/86bcebd393ecf6190bb2debdcaa38d09/46886/lexical_environment.png 452w\"\n        sizes=\"(max-width: 452px) 100vw, 452px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<p>As you can see when trying to resolve the identifier “<em>y</em>” in the foo context, the outer environment (global) is reached out. This process is called identifier resolution and happens on running execution context.</p>\n<p>Now, armed with this knowledge of Environments, let’s get back to the structure of Execution context and see what’s happening there:</p>\n<ul>\n<li><strong>VariableEnvironment</strong>: Its environmentRecord is used for the initial storage for the variables, arguments and function declarations, which later is filled on entering the context activation stage.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">function</span> <span class=\"token function\">foo</span><span class=\"token punctuation\">(</span>a<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">var</span> b <span class=\"token operator\">=</span> <span class=\"token number\">20</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token function\">foo</span><span class=\"token punctuation\">(</span><span class=\"token number\">10</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// The VariableEnvironment component of the foo function</span>\n<span class=\"token comment\">//context at creation stage</span>\nfooContext<span class=\"token punctuation\">.</span>VariableEnvironment <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  environmentRecord<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n    arguments<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span> <span class=\"token number\">0</span><span class=\"token punctuation\">:</span> <span class=\"token number\">10</span><span class=\"token punctuation\">,</span> length<span class=\"token punctuation\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> callee<span class=\"token punctuation\">:</span> foo <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    a<span class=\"token punctuation\">:</span> <span class=\"token number\">10</span><span class=\"token punctuation\">,</span>\n    b<span class=\"token punctuation\">:</span> undefined\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  outer<span class=\"token punctuation\">:</span> globalEnvironment\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// After the execution stage, the VE envRec</span>\n<span class=\"token comment\">// table is filled in with the value</span>\nfooContext<span class=\"token punctuation\">.</span>VariableEnvironment <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  environmentRecord<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n    arguments<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span> <span class=\"token number\">0</span><span class=\"token punctuation\">:</span> <span class=\"token number\">10</span><span class=\"token punctuation\">,</span> length<span class=\"token punctuation\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> callee<span class=\"token punctuation\">:</span> foo <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    a<span class=\"token punctuation\">:</span> <span class=\"token number\">10</span><span class=\"token punctuation\">,</span>\n    b<span class=\"token punctuation\">:</span> <span class=\"token number\">20</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  outer<span class=\"token punctuation\">:</span> globalEnvironment\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<br/>\n<ul>\n<li><strong>LexicalEnvironment</strong>: Initially, it’s just a copy of the VariableEnvironment. On the running context, it is used to determine the binding of an identifier appearing in the context.</li>\n</ul>\n<p>Both <em>VE</em> and <em>LE</em> by their nature are lexical environments, i.e both statically(at creation stage) captures the outer bindings for inner functions created in the context. This mechanism gives rise to closures.</p>\n<blockquote>\n<p>Capturing the outer binding statically for inner functions give rise to the formation of closures.</p>\n</blockquote>\n<h2>Identifier Resolution aka Scope chain lookup</h2>\n<p>Before understanding the closure, let’s understand how the scope chain is created in our execution context. As we saw earlier, each execution context has LexicalEnvironment which is used for identifier resolution. All the local bindings for the context are stored in the environment record table. If identifiers are not resolved in the current environmentRecord, the resolution process will continue to the outer (parent) environment record table. This pattern will continue until the identifier is resolved. If not found, a <em>ReferenceError</em> is thrown.</p>\n<p>This is very similar to the prototype lookup chain. Now, the key to remember here is that <em>LexicalEnvironment</em> captures the outer binding <strong>lexically</strong> (statically) on context creation stage and used as it is on the running context (execution stage).</p>\n<h2>Closures</h2>\n<p>As we saw in the previous section that upon function creation stage, statically saving of outer binding in the <em>LexicalEnvironment</em> of inner context gives rise to closures regardless of whether a function will be activated later or not. Let see that in an example:</p>\n<h3>Example 1:</h3>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">var</span> a <span class=\"token operator\">=</span> <span class=\"token number\">10</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">function</span> <span class=\"token function\">foo</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>a<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">function</span> <span class=\"token function\">bar</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">var</span> a <span class=\"token operator\">=</span> <span class=\"token number\">20</span><span class=\"token punctuation\">;</span>\n  <span class=\"token function\">foo</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token function\">bar</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// will print \"10\"</span></code></pre></div>\n<p>The <em>LexicalEnvironment</em> of foo captures the binding “<em>a</em>” at creation time, which was 10. So, when <em>foo</em> is invoked later (at execution stage), the “<em>a</em>” identifier is resolved with a value of <em>10</em> but not <em>20</em>.</p>\n<p>Conceptually, the identifier resolution process will look something like this:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// check for binding \"a\" in the env record of \"foo\"</span>\n<span class=\"token operator\">--</span> foo<span class=\"token punctuation\">.</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">[</span>LexicalEnvironment<span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">[</span>Record<span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">--</span><span class=\"token operator\">></span> not found\n\n<span class=\"token comment\">// if not found, check for its outer environment</span>\n<span class=\"gatsby-highlight-code-line\"><span class=\"token operator\">--</span><span class=\"token operator\">-</span> global<span class=\"token punctuation\">[</span><span class=\"token punctuation\">[</span>LexicalEnvironment<span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">[</span>Record<span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">--</span><span class=\"token operator\">></span> found <span class=\"token number\">10</span></span><span class=\"token comment\">// resolve the identifier with a value of 1</span></code></pre></div>\n<p>\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/da4e05e7876fc9c8d0c104c8151f2484/75fb1/closure_example_1.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 53.2258064516129%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsSAAALEgHS3X78AAACOElEQVQoz2WTC4+aUBCF/f+/pNk06SPbbrOPWBVd8YGAur5REB+Lyi6K+ED4esU0sdsJJ/dMbjL3zJkhFccx1zhHdNzCtMhxlMMqf2FRvyO28yLPcNxtYNngNMpilr7Sk26YVL+DlSFYmqTOBc51EnCJ8HSgPZSpNJ5QOzlagg9nKj27grN0MKZ1Xswiej+P2suhtH6jDzLMVzapOAq5lIqIzjyOOJz2yP0Sj7Un5EGJ8rBCbawiD8u8rz3mnsPgdcRoaQmMMRyT3nzIm+8Jha8qtnKH03iEuUI0qRD4C/SxTq6eoTaqCiiUezKqVcMPtpc24itcRardk+gI6T2jwHhaxTBl1htXqIwIwiP+fs9mt8Nx3YRHUfRfnes8dVe+51m0JxtlFFsTbSm8+29w9GC3gr2bwF9YSZ5YdPA4+Q7hGRuHaLtETEQMMyCVFW1VhUcXlMm3Clh2n4Nd5K2XRk1/YlD6xtqQCEyJnfApdlvYtVvq2Rua0mdGyg8OVpbNQkzZC9Z427VQ5SXnGcEhQB3IZGoPKOKsj6u0ZjqljsTceaUzaaAKa1SzhGaJzowilUGOmTu9rM3HOIq1KYnppvU0xX4x4fm2JKx5xvM3DFeGsEhGs1VxJ1PoFJK7qTsXa/NxscUXRkfakxaVboUXu0lLcG2o0RR8uwvoL7s8avdUhUKpneWnfMuD9gt7NflX4d8/5XxGUZwsexieOAmc81MYJQ/a7pi6Wac769K0mmiGjj7SWXor/gBeMyr6qMd+7QAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"alt text\"\n        title=\"execution context\"\n        src=\"/static/da4e05e7876fc9c8d0c104c8151f2484/623ee/closure_example_1.png\"\n        srcset=\"/static/da4e05e7876fc9c8d0c104c8151f2484/816c5/closure_example_1.png 148w,\n/static/da4e05e7876fc9c8d0c104c8151f2484/c766b/closure_example_1.png 295w,\n/static/da4e05e7876fc9c8d0c104c8151f2484/623ee/closure_example_1.png 590w,\n/static/da4e05e7876fc9c8d0c104c8151f2484/75fb1/closure_example_1.png 682w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<h3>Example 2</h3>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">function</span> <span class=\"token function\">outer</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n <span class=\"token keyword\">let</span> id <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">return</span> <span class=\"token keyword\">function</span> <span class=\"token function\">inner</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>id<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> innerFunc <span class=\"token operator\">=</span> <span class=\"token function\">outer</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token function\">innerFunc</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// prints 1;</span></code></pre></div>\n<br/>\n<p>When the <em>outer</em> function returns, its execution context is popped out from the execution stack. But when we invoke the <em>innerFunc()</em> later, it still manages to print out the correct value because <em>LexicalEnvironment</em> of inner function statically captured the “<em>id</em>” binding of its outer (parent) environment when it was created.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// check for binding \"id\" in the env record of \"inner\"</span>\n<span class=\"token operator\">--</span> inner<span class=\"token punctuation\">.</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">[</span>LexicalEnvironment<span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">[</span>Record<span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">--</span><span class=\"token operator\">></span> not found\n<span class=\"token comment\">// if not found, check for its outer environment (outer)</span>\n<span class=\"token operator\">--</span><span class=\"token operator\">-</span> outer<span class=\"token punctuation\">[</span><span class=\"token punctuation\">[</span>LexicalEnvironment<span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">[</span>Record<span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">--</span><span class=\"token operator\">></span> found <span class=\"token number\">1</span>\n<span class=\"token comment\">// resolve the identifier with a value of 1</span></code></pre></div>\n<br/>\n<p>\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/b756f46d006f1884caac36cd4b9546df/c15cb/closure_example_2.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 522px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 95.59386973180078%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAATCAYAAACQjC21AAAACXBIWXMAAAsSAAALEgHS3X78AAADYElEQVQ4y5WUC2/iVhBG+f//oqpUqVLTardKGjYJCeFhGwO2eRsINviBCQESXiGJyeng3SjadlvtWrLGvv7ud+f6npkU7gVEGstWmn7uV/zSH2xtGQsKPI5KxPs9h+v19ZXvuVLBsMjwpoDbz9FtX+FIDEYqk1An8Ezi+AcNC70ix9pfZFs5NEen6htYYY2KxLrXYv+jGZYHGlnrEq2notpFKgOd8k2JipjX3NpXhv93v2lSVmByXctS6peoulXqkp3SUTA9g3bQYf9ly7x+25R/Gt6vlyy3G1aPGx42S9a7LX40ZrqYsX7cvnmx/48tv42+maa4a8K8x9O4zmpk8Bw1eXDKcNchXrhyKDGviz7M2qw9i4VTYSG/5dZW2PpyaNMOLy8v7xmu3AzxpIxXO6V6+Qu2+jt33Qw7r8DM1UUUs4uqPAUqUesThmhaxaNE61b/lMVz7Ha7d8OyUyJdOkXrKjRCi85tk/akQSOq0fJbTKd3NPwaB505qsj3BnX5713JuBGa1HxLDJ/eDbW+SlYORekUKcqt3+gy0aQyrMgp13mU1e1JG6VfoCREGH6Vgp2n2C2g9AoYo+rXhrqrcaIck2tdo/YVMSqTb+coORoNr5FgM5j1ubKuyDfzNMcNcvVrzsvnXBoZTNdk9/T8bujPfMJ5yCG6kSsxwB7aOJHDeB4loo0QsNquWQsNDyuhQmjY7DbJ+FIoSVj9gk/qWyhsNs98Z2H8u1Li5Yj90uPlfsRuLpgsfWZSck9zh3g9SVbfryPR+KIR3YPH82LEs+hjeT7ok/nL8HOGL8NLEGwGyhHmp5+4Kf7GonMOocp6VBbDmDiqwFgjNE8wz36mKcgcYmSdJHOJSmyHSsJjquEUKbeusHp56tJ12iONXmjQcBQ6Q0u2v6EfWMl3tXaBYeew/Qr5SprTqyOy2jEZ5SOqmZHFJcOCNIS0fsZ1M4fS1dClEkxhK9fOo3XKLBb3wl1dutE1GSsj+CjSjSzUG5UL64IP+Q9JrLpmUlUpU1Y709OoXcl0UMKSppCtXaILc52xLTW8pze1E+bS+imGV0nQUoTDM8nyMHbA7cBusuW6V6falx4orcoYCPnDOpZTS967QT85lPlqjj8NGEVeglK0mCQxnI0J7sIkRvPbZMt/Ax+bdp6Wf5GkAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"alt text\"\n        title=\"closure example 2\"\n        src=\"/static/b756f46d006f1884caac36cd4b9546df/c15cb/closure_example_2.png\"\n        srcset=\"/static/b756f46d006f1884caac36cd4b9546df/f44a7/closure_example_2.png 148w,\n/static/b756f46d006f1884caac36cd4b9546df/f2052/closure_example_2.png 295w,\n/static/b756f46d006f1884caac36cd4b9546df/c15cb/closure_example_2.png 522w\"\n        sizes=\"(max-width: 522px) 100vw, 522px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<h2>Conclusion</h2>\n<ul>\n<li>Execution context stack follows <strong>LIFO</strong> data structure.</li>\n<li>There’s one Global context where our code/script is executed.</li>\n<li>Call to a function creates a new execution context. If it has a nested function call, a new context is created and is put on top of its parent context. When the function finishes executing, it gets popped out of the stack and flow returns back to the context below in the stack.</li>\n<li>Lexical Environment has two main components: <strong>environmentRecord</strong> and <strong>reference</strong> to outer environment.</li>\n<li><strong>VariableEnvironment</strong> and <strong>LexicalEnvironment</strong> both statically captured the outer binding for inner functions created in the context.\nAll functions at the <strong>creation</strong> stage statically(lexically) captures the outer binding of their parent environment. This allows the nested function to access the outer binding even if the parent context is wiped out from the execution stack. This mechanism is the foundation of closures in JavaScript.</li>\n</ul>\n<p>I hope this article was fun to read and wasn’t overwhelming. Let me know your thoughts in the comments below and if you liked it, a few 👏 will definitely make me smile 😃. Happy coding :)</p>","frontmatter":{"title":"Lexical Environment-the hidden part to understand Closures","date":"May 12, 2019","description":"Functions in ECMAScript captures their parent scope bindings at creation time"}}},"pageContext":{"slug":"/lexical-envrionment-the hidden-part-to-understand-closures/","previous":{"fields":{"slug":"/so-you-think-you-know-JavaScript/"},"frontmatter":{"title":"So you think you know JavaScript?"}},"next":null}}